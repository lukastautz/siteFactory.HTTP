#!/bin/bash
sudo apt update
sudo apt install -y gcc
sudo gcc -o /bin/sitefactory sitefactory.c
sudo mkdir /etc/sitefactory 2>/dev/null
sudo chmod -R 777 /etc/sitefactory
> /etc/sitefactory/default.conf
echo "# Type      Field2               Field3              Value" >> /etc/sitefactory/default.conf
echo "# port      [port]               (null)              (null)" >> /etc/sitefactory/default.conf
echo "# root      for                  [domain]            [path]" >> /etc/sitefactory/default.conf
echo "# deny      for                  [domain]            [*.ext1,*.ext2,...]" >> /etc/sitefactory/default.conf
echo "# 404       for                  [domain]            [path]" >> /etc/sitefactory/default.conf
echo "# index     for                  [domain]            [filename1,filename2,...]" >> /etc/sitefactory/default.conf
echo "" >> /etc/sitefactory/default.conf
echo "port        80" >> /etc/sitefactory/default.conf
echo "" >> /etc/sitefactory/default.conf
echo "root        for                  $(hostname -I | sed 's/ *$//g')        /var/www/default" >> /etc/sitefactory/default.conf
echo "index       for                  $(hostname -I | sed 's/ *$//g')        index.html" >> /etc/sitefactory/default.conf
sudo mkdir /var/www 2>/dev/nulll
sudo mkdir /var/www/default 2>/dev/null
sudo chmod -R 777 /var/www
> /var/www/default/index.html
echo "<!DOCTYPE html>" >> /var/www/default/index.html
echo "<html>" >> /var/www/default/index.html
echo "    <head>" >> /var/www/default/index.html
echo "        <meta charset=\"UTF-8\">" >> /var/www/default/index.html
echo "        <title>Hello World!</title>" >> /var/www/default/index.html
echo "    </head>" >> /var/www/default/index.html
echo "    <body>" >> /var/www/default/index.html
echo "        <h1>Hello World from siteFactory</h1>" >> /var/www/default/index.html
echo "        <p>It works!<br>Config file: <b>/etc/sitefactory/default.conf</b></p>" >> /var/www/default/index.html
echo "    </body>" >> /var/www/default/index.html
echo "</html>" >> /var/www/default/index.html
sudo touch /etc/init.d/sitefactory
sudo chmod 777 /etc/init.d/sitefactory
> /etc/init.d/sitefactory
echo "#!/bin/bash" >> /etc/init.d/sitefactory
echo "### BEGIN INIT INFO" >> /etc/init.d/sitefactory
echo "# Provides:        sitefactory" >> /etc/init.d/sitefactory
echo "# Default-Start:   2 3 4 5" >> /etc/init.d/sitefactory
echo "# Description:     The siteFactory HTTP server" >> /etc/init.d/sitefactory
echo "### END INIT INFO" >> /etc/init.d/sitefactory
echo "NAME=default" >> /etc/init.d/sitefactory
echo "PATH=/bin" >> /etc/init.d/sitefactory
echo "start() {" >> /etc/init.d/sitefactory
echo "    sitefactory /etc/sitefactory/default.conf > /dev/null &" >> /etc/init.d/sitefactory
echo "}" >> /etc/init.d/sitefactory
echo "stop() {" >> /etc/init.d/sitefactory
echo "    kill \`pidof sitefactory\`" >> /etc/init.d/sitefactory
echo "}" >> /etc/init.d/sitefactory
echo "case \"\$1\" in" >> /etc/init.d/sitefactory
echo "    start)" >> /etc/init.d/sitefactory
echo "       start" >> /etc/init.d/sitefactory
echo "       ;;" >> /etc/init.d/sitefactory
echo "    stop)" >> /etc/init.d/sitefactory
echo "       stop" >> /etc/init.d/sitefactory
echo "       ;;" >> /etc/init.d/sitefactory
echo "    restart)" >> /etc/init.d/sitefactory
echo "       stop" >> /etc/init.d/sitefactory
echo "       start" >> /etc/init.d/sitefactory
echo "       ;;" >> /etc/init.d/sitefactory
echo "    *)" >> /etc/init.d/sitefactory
echo "       echo \"Usage: service sitefactory {start|stop|restart}\"" >> /etc/init.d/sitefactory
echo "esac" >> /etc/init.d/sitefactory
echo "exit 0" >> /etc/init.d/sitefactory
sudo chmod 700 /etc/init.d/sitefactory
sudo chmod +x /etc/init.d/sitefactory
sudo update-rc.d sitefactory defaults
sudo service sitefactory start
echo "The siteFactory HTTP server is successfully installed!"
echo "The configuration file is \"/etc/sitefactory/default.conf\"."
echo "If you want to apply changes in the config, you have to restart siteFactory with \"service sitefactory restart\"."
echo "siteFactory will start automatically on boot."
